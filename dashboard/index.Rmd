---
title: "New Zealand Police Shootings"
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
    vertical_layout: fill
    theme:
      version: 4
      bootswatch: cerulean
    social: ["twitter", "linkedin"]
    source_code: 'https://github.com/dataforyounz/nz-police-shootings/tree/main'
---

```{r setup, include=FALSE}
library( flexdashboard )
library( dplyr )
library( DT )
library( leaflet )
library( highcharter )
library( lubridate )

data_folder <- "dat"
data_file   <- "shooting_data.Rdata"
data_path   <- file.path( data_folder, data_file )

# Load shooting data
load( data_path )

shooting_df <- shooting_df %>% 
               mutate( 
                 fatal_fl = case_when(
                              Outcome.of.Shots.Fired %in% c("Fatal", "Fatal (bystander)", 
                                                          "Fatal-cause unconfirmed") ~ 1,
                              TRUE ~ 0
                            ),
                 non_fatal_fl = case_when(
                              Outcome.of.Shots.Fired %in% c("Non-fatal injury", "Non-fatal injury (offender)", 
                                                          "Non-fatal injury (bystander)") ~ 1,
                              TRUE ~ 0
                            ),
                 outcome_category = case_when(
                                          fatal_fl == 1 ~ "Fatal",
                                          non_fatal_fl == 1 ~ "Non-Fatal",
                                          TRUE ~ "Miss"
                                      )
               )
               
                        
# Measures
total_shootings <- nrow( shooting_df )
total_fatal     <- nrow( shooting_df %>% filter( fatal_fl == 1) )
total_non_fatal <- nrow( shooting_df %>% filter( non_fatal_fl == 1) )
total_miss      <- nrow( shooting_df %>% filter( non_fatal_fl != 1 & fatal_fl != 1) )

# Summary data for shootings per year
shootings_by_year <- tibble( shooting_df ) %>% 
                     mutate( year = year(Incident.Date) ) %>% 
                     summarise( n = n(), .by = c(year, outcome_category)) %>% 
                     rename( Count = n, Year = year, Outcome = outcome_category ) 

```

About
===================================================================

#### About this dashbaord

---

Visualises data about police shootings between 1916 â€“ 2021

Link to data 

Last updated: `r format(Sys.Date(), "%d/%m/%Y")`

---

Shootings 
===================================================================

Row
--------------------------------- 

### 

```{r }
flexdashboard::valueBox( value = total_shootings, 
                         caption = "Total Police Shootings", 
                         icon = "fa-info")
```

###

```{r}
flexdashboard::valueBox( value = total_fatal, 
                         caption = "Total Fatal Shootings",
                         icon = "fa-info")
```

###

```{r}
flexdashboard::valueBox( value = total_non_fatal, 
                         caption = "Total Non-Fatal Shootings",
                         icon = "fa-info" )
```

###

```{r}
flexdashboard::valueBox( value = total_miss, 
                         caption = "Total Shots Missed",
                         icon = "fa-info" )
```


Row
--------------------------------- 

### Chart A

```{r}

leaflet() %>% addTiles()

```

### Number of Police Shootings per Year

```{r}

hchart( shootings_by_year, "column", 
        hcaes(x = Year, y = Count, group = Outcome) ) %>% 
  #hc_title(text = "Number of Police Shootings per Year") %>% 
  hc_plotOptions( column = list(stacking = "normal" )) %>% 
  hc_yAxis( title = list(text = "Number of Shootings") )

```

> Source: New Zealand Police

Data 
===================================================================

##### Use the buttons below to export the data

### 

```{r}

datatable( shooting_df )

```

